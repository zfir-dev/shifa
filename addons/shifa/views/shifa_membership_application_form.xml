<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
    <!-- Public page -->
    <record id="membership_form_template" model="ir.ui.view">
      <field name="name">SHIFA Membership Form</field>
      <field name="type">qweb</field>
      <field name="key">shifa.membership_form_template</field>
      <field name="arch" type="xml">
        <t t-name="shifa.membership_form_template">
          <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
              <div class="container mt-5 mb-5">
                <h2 class="text-center mb-4">SHIFA Membership Application</h2>
                <form action="/shifa/membership/submit" method="post" class="form">
                  <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                  
                  <h4>Member Details</h4>
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label>Full Name</label>
                      <input type="text" name="name" required="required" class="form-control"/>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label>National ID</label>
                      <input type="text" name="national_id" required="required" class="form-control"/>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label>Date of Birth</label>
                      <input type="date" name="dob" class="form-control"/>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label>Email</label>
                      <input type="email" name="email" class="form-control"/>
                    </div>
                  </div>

                  <div class="mb-3">
                    <label>Address</label>
                    <textarea name="address" class="form-control"></textarea>
                  </div>
                  <div class="mb-3">
                    <label>Phone</label>
                    <input type="text" name="phone" class="form-control"/>
                  </div>

                  <h4 class="mt-4">Optional Donation</h4>
                  <div class="mb-3">
                    <label>Donation Amount (Optional)</label>
                    <input type="number" name="donation_amount" class="form-control" step="0.01" min="0" placeholder="0.00"/>
                    <small class="form-text text-muted">You will receive an invoice after approval. Payment can be made via Bank or Juice.</small>
                  </div>

                  <h4 class="mt-4">Dependents (optional)</h4>
                  <div class="mb-3">
                    <p><strong>List all persons you wish to register as your dependants</strong></p>
                    <p><strong>Category (Eligible Dependants) are limited to:</strong></p>
                    <ol>
                      <li>Your lawful spouse.</li>
                      <li>Your unemployed children up to age 18.</li>
                      <li>Your unmarried &amp; unemployed children up to age 23 if in full-time education/vocational training.</li>
                      <li>A care-dependent relative (e.g., parent, sibling, grandchild) who is permanently resident with you, medically certified as incapacitated, and wholly financially dependent on you.</li>
                      <li>A child or spouse of any age with a total and permanent disability.</li>
                      <li>Orphan</li>
                    </ol>
                    <p>Supporting documents (e.g., birth certificate, marriage certificate, student ID, medical certificate) must be submitted with this form upon request by the Secretary.</p>
                  </div>
                  <div id="dependents-container"></div>
                  <button type="button" class="btn btn-outline-primary mt-2" id="add-dependent-btn">
                    <i class="fa fa-plus"></i> Add Dependent
                  </button>

                  <script>
                    let dependentCount = 0;

                    function removeDependentScript(index) {
                      document.getElementById('dependent-' + index).remove();
                    }

                    function addDependentScript() {
                      dependentCount++;
                      const container = document.getElementById('dependents-container');
                      const dependentHtml = `
                        <div class="border rounded p-3 mb-2" id="dependent-${dependentCount}">
                          <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="mb-0">Dependent ${dependentCount}</h6>
                            <button type="button" class="btn btn-sm btn-danger" onclick="removeDependentScript(${dependentCount})">
                              <i class="fa fa-times"></i> Remove
                            </button>
                          </div>
                          <input type="text" name="dep_name_${dependentCount}" placeholder="Full Name" class="form-control mb-2"/>
                          <input type="date" name="dep_dob_${dependentCount}" class="form-control mb-2" placeholder="Date of Birth"/>
                          <div class="row">
                            <div class="col-md-6">
                              <select name="dep_relation_${dependentCount}" class="form-select mb-1">
                                <option value="">Select Relationship</option>
                                <option value="spouse">Spouse</option>
                                <option value="child">Child</option>
                                <option value="relative">Care-dependent Relative</option>
                                <option value="disabled">Disabled Dependent</option>
                              </select>
                            </div>
                            <div class="col-md-6">
                              <label class="form-check">
                                <input class="form-check-input" type="checkbox" name="dep_care_${dependentCount}"/> Care Dependent
                              </label>
                              <label class="form-check">
                                <input class="form-check-input" type="checkbox" name="dep_orphan_${dependentCount}"/> Orphan
                              </label>
                              <label class="form-check">
                                <input class="form-check-input" type="checkbox" name="dep_auto_${dependentCount}"/> Auto-Promote
                              </label>
                            </div>
                          </div>
                        </div>
                      `;
                      container.insertAdjacentHTML('beforeend', dependentHtml);
                    }

                    document.getElementById('add-dependent-btn').addEventListener('click', addDependentScript);
                  </script>

                  <div class="mt-4">
                    <div class="declaration">
                      <p>I hereby apply for membership in SHIFA and declare that I have read, understood, and agree to abide by the rules of the Association. I acknowledge the following key provisions:</p>

                      <h3>1. FEES &amp; PAYMENTS</h3>
                      <ul>
                        <li>A non-refundable Entrance Fee of Rs 500 and an Annual Subscription of Rs 1000 are payable upon application.</li>
                        <li>A Supplementary Fee of Rs 500 is payable for each dependant registered (See Verso).</li>
                        <li>All fees for the year are due on 1st January and must be paid in full by 31st March.</li>
                        <li>Membership is effective only upon payment of all applicable fees.</li>
                      </ul>

                      <h3>2. MEDICAL CARE ASSISTANCE</h3>
                      <ul>
                        <li>Claims for medical care assistance submitted on behalf of a member or their dependant(s) shall be subject to the eligibility criteria set forth in Article 18 of the Association's Rules.</li>
                        <li>No medical claims are payable during the first two (2) years of membership, except in exceptional circumstances at the Managing Committee's discretion.</li>
                        <li>Members who are in arrears with their subscriptions for more than three (3) months are ineligible for any medical assistance.</li>
                        <li>The Managing Committee's decision on all claims is final and binding.</li>
                      </ul>

                      <h3>3. DISCIPLINE &amp; TERMINATION</h3>
                      <ul>
                        <li>Membership may be terminated for misconduct, subject to a right of appeal to a Special General Meeting.</li>
                        <li>A member who resigns or is expelled forfeits all rights to the Association's property and any contributions made.</li>
                        <li>The Managing Committee's decision on membership admission is final and does not require justification.</li>
                      </ul>
                    </div>

                    <div class="form-check mt-3">
                      <input type="checkbox" id="policy_agree" name="policy_agree" required="required" class="form-check-input"/>
                      <label for="policy_agree" class="form-check-label">I confirm that I have read, understood and agree to the policy above.</label>
                    </div>

                    <div class="form-check mt-2">
                      <input type="checkbox" id="communications" name="communications" required="required" class="form-check-input"/>
                      <label for="communications" class="form-check-label"><strong>I agree to receive communications from the Association on the mobile number provided above</strong></label>
                    </div>

                    <div class="mt-3">
                      <button type="submit" class="btn btn-primary">Submit Application</button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </t>
        </t>
      </field>
    </record>

    <!-- Success page -->
    <record id="membership_application_form_success" model="ir.ui.view">
      <field name="name">Membership Success</field>
      <field name="type">qweb</field>
      <field name="key">shifa.membership_application_form_success</field>
      <field name="arch" type="xml">
        <t t-name="shifa.membership_application_form_success">
          <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
              <div class="container text-center mt-5 mb-5">
                <div style="background:#2b9edb;color:white;padding:14px;border-radius:6px;text-align:left;margin-bottom:18px;">
                  <strong style="font-size:18px;">APPLICATION COMPLETE</strong>
                </div>

                <h3>Thank you for completing your membership application!</h3>
                <p class="lead">Your application has been successfully submitted. Please follow these next steps:</p>

                <div class="alert alert-success mt-4 text-start">
                  <ol>
                    <li>Print or download the PDF version of your application</li>
                    <li>Sign the application form in the designated areas</li>
                    <li>Submit the signed form to the SHIFA office</li>
                    <li>You will receive a member ID once your application is processed</li>
                  </ol>
                  <p class="mt-2">You can use your member ID to log in later and upload signed documents or check your application status.</p>
                </div>

                <div style="display:flex;justify-content:center;gap:14px;margin-top:18px;">
                  <button type="button" class="btn btn-primary" onclick="window.print()">Print This Page</button>
                  <a t-att-href="'/shifa/membership/pdf/%s' % member.id" 
                     class="btn btn-success">Download PDF</a>
                </div>

                <div style="margin-top:18px;">
                  <a href="/" class="btn btn-outline-secondary mt-3">Return Home</a>
                </div>
              </div>
            </div>
          </t>
        </t>
      </field>
    </record>

    <!-- PDF Error page -->
    <record id="membership_pdf_error" model="ir.ui.view">
      <field name="name">PDF Generation Error</field>
      <field name="type">qweb</field>
      <field name="key">shifa.membership_pdf_error</field>
      <field name="arch" type="xml">
        <t t-name="shifa.membership_pdf_error">
          <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
              <div class="container text-center mt-5 mb-5">
                <div class="alert alert-danger">
                  <h3>PDF Generation Error</h3>
                  <p>We encountered an issue generating your PDF. Please try again later or contact support.</p>
                  <p class="small">Error details: <t t-esc="error"/></p>
                </div>
                <a href="/" class="btn btn-primary">Return Home</a>
              </div>
            </div>
          </t>
        </t>
      </field>
    </record>

    <!-- Website Menu -->
    <record id="menu_membership_form" model="website.menu">
      <field name="name">Join SHIFA</field>
      <field name="url">/shifa/membership</field>
      <field name="parent_id" ref="website.main_menu"/>
      <field name="sequence" type="int">50</field>
    </record>
  </data>
</odoo>
